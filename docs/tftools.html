---

title: tftools

keywords: fastai
sidebar: home_sidebar

summary: "Functions for use with TensorFlow 2.x"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/02_tftools.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="References">References<a class="anchor-link" href="#References">&#182;</a></h2><p>The functions below are based on the below sources. Please visit attached links for further understanding.:</p>
<ul>
<li>Chapter 14 – Deep Computer Vision Using Convolutional Neural Networks, Hands-on Machine Learning with Scikit-Learn, Keras and TensorFlow 2nd Edition by Aurélien Geron: <a href="https://github.com/ageron/handson-ml2/blob/master/14_deep_computer_vision_with_cnns.ipynb">Github link to notebook</a><ul>
<li>In particular, functions <a href="tftools.html#random_crop"><code>random_crop</code></a> and <a href="tftools.html#central_crop"><code>central_crop</code></a> are used</li>
</ul>
</li>
<li>Tensorflow Documentation by The Tensorflow Authors:<ul>
<li><a href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/load_data/images.ipynb">Load Images Notebook Github Link</a></li>
<li><a href="https://www.tensorflow.org/api_docs/python/tf/image">tf.image API documentation</a></li>
<li><a href="https://github.com/tensorflow/docs/blob/master/site/en/tutorials/images/transfer_learning.ipynb">Transfer learning with a pretrained ConvNet</a></li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Image-Augmentation">Image Augmentation<a class="anchor-link" href="#Image-Augmentation">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="random_crop" class="doc_header"><code>random_crop</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L15" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>random_crop</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Random crop of image</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="central_crop" class="doc_header"><code>central_crop</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L22" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>central_crop</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Center crop of image</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="random_flip" class="doc_header"><code>random_flip</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L33" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>random_flip</code>(<strong><code>image</code></strong>, <strong><code>horiz</code></strong>=<em><code>True</code></em>, <strong><code>vert</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Randomly flips an image horizontally and/or vertically</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="random_brightness" class="doc_header"><code>random_brightness</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>random_brightness</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Randomly adjust brightness of image</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="random_contrast" class="doc_header"><code>random_contrast</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L46" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>random_contrast</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Randomly adjust contrast of image</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="random_rotate" class="doc_header"><code>random_rotate</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L51" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>random_rotate</code>(<strong><code>image</code></strong>)</p>
</blockquote>
<p>Randomly rotates image and angles are in radians.
Requires tensorflow-addons that currently supports MacOS and Linux only.</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset-reading-and-processing">Dataset reading and processing<a class="anchor-link" href="#Dataset-reading-and-processing">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_label" class="doc_header"><code>get_label</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_label</code>(<strong><code>file_path</code></strong>, <strong><code>CLASS_NAMES</code></strong>)</p>
</blockquote>
<p>Return label of image for tf.data.Dataset</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_test_split" class="doc_header"><code>train_test_split</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L68" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_test_split</code>(<strong><code>files</code></strong>, <strong><code>valid_pct</code></strong>=<em><code>0.2</code></em>, <strong><code>seed</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Reads in list of file Path objects and randomly split into training and validation</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_img_path" class="doc_header"><code>process_img_path</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L78" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_img_path</code>(<strong><code>file_path</code></strong>, <strong><code>CLASS_NAMES</code></strong>=<em><code>None</code></em>, <strong><code>img_size</code></strong>=<em><code>224</code></em>, <strong><code>augments</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>process image for use with tf.data map function</p>
<ul>
<li>get label</li>
<li>read and decode using tf.image</li>
<li>expects two augmentation function lists - one for train, the other for valid/test</li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_img_bytes" class="doc_header"><code>process_img_bytes</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L101" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_img_bytes</code>(<strong><code>img_bytes</code></strong>, <strong><code>img_size</code></strong>=<em><code>224</code></em>, <strong><code>augments</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Process single image in int-byte form for use with keras model.predict()</p>
<ul>
<li>read with in raw file bytes with functions like tf.io.read_file</li>
<li>decode using tf.image</li>
<li>supports one augmentation function list, typically for validation</li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="read_img_dataset" class="doc_header"><code>read_img_dataset</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L121" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>read_img_dataset</code>(<strong><code>file_paths</code></strong>, <strong><code>CLASS_NAMES</code></strong>=<em><code>None</code></em>, <strong><code>shuffle_size</code></strong>=<em><code>None</code></em>, <strong><code>img_size</code></strong>=<em><code>224</code></em>, <strong><code>batch_size</code></strong>=<em><code>32</code></em>, <strong><code>n_parallel</code></strong>=<em><code>4</code></em>, <strong><code>augments</code></strong>=<em><code>None</code></em>, <strong><code>mode</code></strong>=<em><code>'train'</code></em>)</p>
</blockquote>
<p>Image dataset reader for tf.data.Dataset</p>
<ul>
<li>get files from folder/list of Pathlib objects</li>
<li>modes of operation: train, valid, test</li>
<li>cache for all modes using local disk cache with mode as name of cache</li>
<li>only shuffle if mode=train. shuffle expects a shuffle size</li>
</ul>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example:-Read-images-from-folder-of-Imagenet-style">Example: Read images from folder of Imagenet style<a class="anchor-link" href="#Example:-Read-images-from-folder-of-Imagenet-style">&#182;</a></h3><p>Sample:</p>
<ul>
<li>data<ul>
<li>train<ul>
<li>class1</li>
<li>class2</li>
</ul>
</li>
<li>valid<ul>
<li>class1</li>
<li>class2</li>
</ul>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># datapath = Path(&#39;path/to/data&#39;)</span>
<span class="c1"># train_aug = [rcrop, rflip]</span>
<span class="c1"># valid_aug = [crop]</span>
<span class="c1"># aug = (train_aug, valid_aug)</span>
<span class="c1"># train_ds = read_img_dataset(str(datapath/train/&#39;*/*&#39;), shuffle=1024, img_size=224, batch_size=32, n_parallel=4, augments=aug, mode=&#39;train&#39;)</span>
<span class="c1"># valid_ds = read_img_dataset(str(datapath/valid/&#39;*/*&#39;), img_size=224, batch_size=32, n_parallel=4, augments=aug, mode=&#39;valid&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Example:-Read-images-from-folder-(or-list)-and-then-shuffle-split-into-train-and-validation">Example: Read images from folder (or list) and then shuffle split into train and validation<a class="anchor-link" href="#Example:-Read-images-from-folder-(or-list)-and-then-shuffle-split-into-train-and-validation">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># datapath = Path(&#39;path/to/data&#39;)</span>
<span class="c1"># all_files = get_all_files(datapath, recurse=True) # read from folder, can be list</span>
<span class="c1"># train_filepaths, tmp_filepaths = train_test_split(all_files, valid_pct=0.3, seed=42)</span>
<span class="c1"># valid_filepaths, test_filepaths = train_test_split(tmp_filepaths, valid_pct=0.5, seed=42)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># train_ds = read_img_dataset([str(x) for x in train_filepaths], shuffle_size=1024, img_size=IMG_SIZE, batch_size=BATCH_SIZE, n_parallel=4, augments=aug, mode=&#39;train&#39;)</span>
<span class="c1"># valid_ds = read_img_dataset([str(x) for x in valid_filepaths], img_size=IMG_SIZE, batch_size=BATCH_SIZE, n_parallel=4, augments=aug, mode=&#39;valid&#39;)</span>
<span class="c1"># test_ds = read_img_dataset([str(x) for x in test_filepaths], img_size=IMG_SIZE, batch_size=BATCH_SIZE, n_parallel=4, augments=aug, mode=&#39;test&#39;)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Visualizations">Visualizations<a class="anchor-link" href="#Visualizations">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="show_batch" class="doc_header"><code>show_batch</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L143" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>show_batch</code>(<strong><code>dataset</code></strong>, <strong><code>CLASS_NAMES</code></strong>)</p>
</blockquote>
<p>displays batch of 25 images from a batch of tf.data.Dataset</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_history" class="doc_header"><code>plot_history</code><a href="https://github.com/yoke2/suptools/tree/master/suptools/tftools.py#L156" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_history</code>(<strong><code>history</code></strong>)</p>
</blockquote>
<p>Plots accuracy and loss for training and validation
Needs history output from model.fit()</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<ul>
<li>Plot history from model.fit using tf.keras</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># plot_history(history)</span>
</pre></div>

    </div>
</div>
</div>

</div>
</div>
 

